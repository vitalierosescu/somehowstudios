<!-- -->
<!-- gsap -->
<!-- -->
<script
  defer
  src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"
></script>
<!-- gsap - ScrollTrigger -->
<script
  defer
  src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/ScrollTrigger.min.js"
></script>
<!-- gsap - Draggable -->
<script
  defer
  src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/Draggable.min.js"
></script>
<!-- gsap - SplitText -->
<script
  defer
  src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/SplitText.min.js"
></script>
<!-- gsap - CustomEase -->
<script
  defer
  src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/CustomEase.min.js"
></script>
<!-- gsap - FLIP -->
<script
  defer
  src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/Flip.min.js"
></script>
<!-- gsap - Inertia Plugin -->
<script
  defer
  src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/InertiaPlugin.min.js"
></script>
<!-- -->
<!-- lenis -->
<!-- -->
<script defer src="https://unpkg.com/lenis@1.3.1/dist/lenis.min.js"></script>

<!-- global.js -->
<script
  defer
  src="https://cdn.flowblock.co/public/files/682355bafaa00db018c721b6/global.js"
></script>

<!-- textAnimations.js -->
<script
  defer
  src="https://cdn.flowblock.co/public/files/682355bafaa00db018c721b6/textAnimations.js"
></script>

<!-- buttonMagnetic.js -->
<script
  defer
  src="https://cdn.flowblock.co/public/files/682355bafaa00db018c721b6/buttonMagnetic.js"
></script>

<!-- nav.js -->
<script
  defer
  src="https://cdn.flowblock.co/public/files/682355bafaa00db018c721b6/nav.js"
></script>

<script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script>
<script>
  const jsConfetti = new JSConfetti()
  console.log('hi')

  let lastConfettiTime = 0
  const confettiCooldown = 2000 // 2 seconds

  document.querySelectorAll('.confetti-trigger').forEach((confettiTrigger) => {
    console.log('i exist')
    confettiTrigger.addEventListener('mouseenter', () => {
      console.log('im inside')
      const now = Date.now()
      if (now - lastConfettiTime > confettiCooldown) {
        jsConfetti.addConfetti({
          emojis: ['ðŸª‘'],
          emojiSize: 250,
          confettiNumber: 20,
        })
        lastConfettiTime = now
      }
    })
    // Optional: for touch devices
    confettiTrigger.addEventListener('touchstart', () => {
      const now = Date.now()
      if (now - lastConfettiTime > confettiCooldown) {
        jsConfetti.addConfetti({
          emojis: ['ðŸª‘'],
          emojiSize: 250,
          confettiNumber: 20,
        })
        lastConfettiTime = now
      }
    })
  })
</script>

<script>
  // Footer Job Counter
  document.addEventListener('DOMContentLoaded', function () {
    const jobcounter = document.querySelectorAll('.cms-jobs-counter').length
    const footerCounter = document.querySelector('.footer-jobs-counter')

    if (footerCounter) {
      if (jobcounter !== 0) {
        footerCounter.textContent = jobcounter
      } else {
        footerCounter.classList.add('hide')
      }
    }
  })
</script>

<!-- Logo marquee -->
<script>
  function initMarqueeScrollDirection() {
    document
      .querySelectorAll('[data-marquee-scroll-direction-target]')
      .forEach((marquee) => {
        // Query marquee elements
        const marqueeContent = marquee.querySelector(
          '[data-marquee-collection-target]'
        )
        const marqueeScroll = marquee.querySelector(
          '[data-marquee-scroll-target]'
        )
        if (!marqueeContent || !marqueeScroll) return

        // Get data attributes
        const {
          marqueeSpeed: speed,
          marqueeDirection: direction,
          marqueeDuplicate: duplicate,
          marqueeScrollSpeed: scrollSpeed,
        } = marquee.dataset

        // Convert data attributes to usable types
        const marqueeSpeedAttr = parseFloat(speed)
        const marqueeDirectionAttr = direction === 'right' ? 1 : -1 // 1 for right, -1 for left
        const duplicateAmount = parseInt(duplicate || 0)
        const scrollSpeedAttr = parseFloat(scrollSpeed)
        const speedMultiplier =
          window.innerWidth < 479 ? 0.25 : window.innerWidth < 991 ? 0.5 : 1

        let marqueeSpeed =
          marqueeSpeedAttr *
          (marqueeContent.offsetWidth / window.innerWidth) *
          speedMultiplier

        // Precompute styles for the scroll container
        marqueeScroll.style.marginLeft = `${scrollSpeedAttr * -1}%`
        marqueeScroll.style.width = `${scrollSpeedAttr * 2 + 100}%`

        // Duplicate marquee content
        if (duplicateAmount > 0) {
          const fragment = document.createDocumentFragment()
          for (let i = 0; i < duplicateAmount; i++) {
            fragment.appendChild(marqueeContent.cloneNode(true))
          }
          marqueeScroll.appendChild(fragment)
        }

        // GSAP animation for marquee content
        const marqueeItems = marquee.querySelectorAll(
          '[data-marquee-collection-target]'
        )
        const animation = gsap
          .to(marqueeItems, {
            xPercent: -100, // Move completely out of view
            repeat: -1,
            duration: marqueeSpeed,
            ease: 'linear',
          })
          .totalProgress(0.5)

        // Initialize marquee in the correct direction
        gsap.set(marqueeItems, {
          xPercent: marqueeDirectionAttr === 1 ? 100 : -100,
        })
        animation.timeScale(marqueeDirectionAttr) // Set correct direction
        animation.play() // Start animation immediately

        // Set initial marquee status
        marquee.setAttribute('data-marquee-status', 'normal')

        // ScrollTrigger logic for direction inversion
        ScrollTrigger.create({
          trigger: marquee,
          start: 'top bottom',
          end: 'bottom top',
          onUpdate: (self) => {
            const isInverted = self.direction === 1 // Scrolling down
            const currentDirection = isInverted
              ? -marqueeDirectionAttr
              : marqueeDirectionAttr

            // Update animation direction and marquee status
            animation.timeScale(currentDirection)
            marquee.setAttribute(
              'data-marquee-status',
              isInverted ? 'normal' : 'inverted'
            )
          },
        })

        // Extra speed effect on scroll
        const tl = gsap.timeline({
          scrollTrigger: {
            trigger: marquee,
            start: '0% 100%',
            end: '100% 0%',
            scrub: 0,
          },
        })

        const scrollStart =
          marqueeDirectionAttr === -1 ? scrollSpeedAttr : -scrollSpeedAttr
        const scrollEnd = -scrollStart

        tl.fromTo(
          marqueeScroll,
          { x: `${scrollStart}vw` },
          { x: `${scrollEnd}vw`, ease: 'none' }
        )
      })
  }

  // Initialize Marquee with Scroll Direction
  document.addEventListener('DOMContentLoaded', () => {
    initMarqueeScrollDirection()
  })
</script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    if (typeof window.gsap === 'undefined')
      document.documentElement.classList.add('gsap-not-found')
    gsap.registerPlugin(ScrollTrigger, SplitText)
  })
</script>

<script>
  {
    let lenis

    const initScroll = () => {
      lenis = new Lenis({})
      lenis.on('scroll', ScrollTrigger.update)
      gsap.ticker.add((time) => lenis.raf(time * 1000))
      gsap.ticker.lagSmoothing(0)

      $('[data-lenis-start]').on('click', function () {
        lenis.start()
      })
      $('[data-lenis-stop]').on('click', function () {
        lenis.stop()
      })
      $('[data-lenis-toggle]').on('click', function () {
        $(this).toggleClass('stop-scroll')
        if ($(this).hasClass('stop-scroll')) {
          lenis.stop()
        } else {
          lenis.start()
        }
      })
    }

    function initGsapGlobal() {
      initScroll()

      const sendGsapEvent = () => {
        window.dispatchEvent(
          new CustomEvent('GSAPReady', {
            detail: {
              lenis,
            },
          })
        )
      }

      // Check if fonts are already loaded
      if (document.fonts.status === 'loaded') {
        sendGsapEvent()
      } else {
        document.fonts.ready.then(() => {
          sendGsapEvent()
        })
      }

      let resizeTimeout
      const onResize = () => {
        clearTimeout(resizeTimeout)
        resizeTimeout = setTimeout(() => {
          ScrollTrigger.refresh()
        }, 10000)
      }

      window.addEventListener('resize', () => onResize())
      const resizeObserver = new ResizeObserver((entries) => onResize())
      resizeObserver.observe(document.body)

      queueMicrotask(() => {
        gsap.to("[data-start='hidden']", {
          autoAlpha: 1,
          duration: 0.4,
          delay: 0.1,
        })
      })
    }

    // this only for dev
    const documentReady =
      document.readyState === 'complete' ||
      document.readyState === 'interactive'

    if (documentReady) {
      initGsapGlobal()
    } else {
      addEventListener('DOMContentLoaded', (event) => initGsapGlobal())
    }
  }
</script>
